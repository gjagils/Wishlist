version: '3.8'

services:
  wishlist:
    image: python:3.12-slim
    container_name: wishlist
    restart: unless-stopped

    ports:
      - "6754:5000"

    volumes:
      - /volume1/docker/wishlist/app:/app
      - /volume1/docker/wishlist/data:/data

    working_dir: /app

    # Laad environment variables uit .env bestand
    env_file:
      - /volume1/docker/wishlist/.env

    command: >
      sh -c "
      apt-get update -qq &&
      apt-get install -y -qq git curl &&
      rm -rf /app/* &&
      git clone -b claude/wishlist-web-interface-80kID https://github.com/gjagils/Wishlist.git /tmp/repo &&
      cp -r /tmp/repo/* /app/ &&
      chmod -R 777 /data &&
      rm -rf __pycache__ &&
      pip install --no-cache-dir -r requirements.txt &&
      python run_all.py
      "

    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5000/api/health', timeout=5)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
